<!DOCTYPE html>
<html>
<head>
    <title>Loan Payment | Khalti/eSewa</title>
    <style>
        body { font-family: Arial; background: #f4f4f4; text-align: center; margin: 0; padding: 0; }
        .logo-top { width: 150px; margin-top: 20px; }
        .box { 
            background: white; padding: 25px; margin: 20px auto; width: 380px; 
            border-radius: 10px; box-shadow: 0 0 10px #bbb; 
        }
        input, select { 
            width: 100%; padding: 10px; margin: 10px 0; 
            border-radius: 5px; border: 1px solid #ccc; 
        }
        button { 
            width: 100%; padding: 12px; border-radius: 5px; cursor: pointer; 
            font-size: 16px; border: none; margin-top: 10px; 
        }
        .khalti { background: #5d2e8c; color: white; }
        .esewa { background: #1ba548; color: white; }
        .gateway-logo { width: 130px; }
        .invoice { 
            display: none; max-width: 600px; margin: 20px auto; 
            background: white; padding: 20px; 
            box-shadow: 0 0 10px #aaa; border-radius: 10px; 
            text-align: left; 
        }
        .invoice h2 { text-align: center; }
        hr { margin: 10px 0; }
        .popup {
            display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.6); justify-content:center; align-items:center;
        }
        .popup-content {
            background:white; width:300px; padding:25px; border-radius:10px; text-align:center;
        }
    </style>
</head>
<body>

<!-- YOUR LOAN SYSTEM LOGO -->
<img class="logo-top" src="Main_logo.png">

<!-- Payment Section -->
<div class="box" id="payment-box">
    <h2>Loan EMI Payment</h2>

    <label>Your Name</label>
    <input type="text" id="username" placeholder="Enter your name">

    <label>Loan Type</label>
    <select id="loanType">
        <option value="Personal Loan">Personal Loan</option>
        <option value="Home Loan">Home Loan</option>
        <option value="Education Loan">Education Loan</option>
        <option value="Auto Loan">Auto Loan</option>
    </select>

    <label>Enter Amount to Pay Now (₹)</label>
    <input type="number" id="amountInput" placeholder="500">

    <p>Select Payment Method:</p>

    <!-- Khalti -->
    <button class="khalti" onclick="openPopup('khalti')">
        <img src="khalti_logo.png" class="gateway-logo"><br>
        Pay with Khalti
    </button>

    <!-- eSewa -->
    <button class="esewa" onclick="openPopup('esewa')">
        <img src="esewalogo.png" class="gateway-logo"><br>
        Pay with eSewa
    </button>
</div>

<!-- Fake Payment Popup -->
<div class="popup" id="payment-popup">
    <div class="popup-content">
        <h3 id="gateway-name"></h3>
        <p>Enter Mobile Number</p>
        <input type="text" placeholder="98XXXXXXXX">

        <p>Enter MPIN</p>
        <input type="password" placeholder="****">

        <button onclick="completePayment()">Confirm Payment</button>
        <button onclick="closePopup()" style="background:#ccc; margin-top:10px;">Cancel</button>
    </div>
</div>

<!-- Invoice Section -->
<div class="invoice" id="invoice-box">
    <h2>Payment Invoice</h2>
    <hr>
    <img class="logo-top" src="Main_logo.png">

    <p><strong>Name:</strong> <span id="inv-name"></span></p>
    <p><strong>Loan Type:</strong> <span id="inv-type"></span></p>

    <hr>

    <p><strong>Amount Paid:</strong> ₹<span id="paid-amount"></span></p>
    <p><strong>Transaction ID:</strong> <span id="txn-id"></span></p>
    <p><strong>Date:</strong> <span id="paid-date"></span></p>

    <p><strong>Payment Method:</strong></p>
    <img id="pay-logo" class="gateway-logo">

    <hr>
    <p>This is a computer-generated invoice.</p>

    <button onclick="downloadInvoice()">Download PDF</button>
</div>

<!-- PDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let selectedGateway = "";

// open popup
function openPopup(gateway) {
    selectedGateway = gateway;
    document.getElementById("gateway-name").innerText =
        gateway === "khalti" ? "Khalti Payment" : "eSewa Payment";
    document.getElementById("payment-popup").style.display = "flex";
}

function closePopup() {
    document.getElementById("payment-popup").style.display = "none";
}

// payment process
function completePayment() {
    let name = document.getElementById("username").value;
    let type = document.getElementById("loanType").value;
    let amount = document.getElementById("amountInput").value;

    if (!name || !amount) {
        alert("Please fill all fields!");
        return;
    }

    closePopup();

    // transaction id
    let txn = (selectedGateway === "khalti" ? "KHALTI-" : "ESEWA-") +
               Math.floor(Math.random() * 1000000000);

    // invoice injection
    document.getElementById("inv-name").innerText = name;
    document.getElementById("inv-type").innerText = type;

    document.getElementById("paid-amount").innerText = amount;
    document.getElementById("txn-id").innerText = txn;
    document.getElementById("paid-date").innerText = new Date().toLocaleString();

    // payment logo
    document.getElementById("pay-logo").src =
        selectedGateway === "khalti"
        ? "https://upload.wikimedia.org/wikipedia/commons/1/14/Khalti_Logo.png"
        : "https://upload.wikimedia.org/wikipedia/commons/f/f1/ESewa_logo.png";

    // hide payment, show invoice
    document.getElementById("payment-box").style.display = "none";
    document.getElementById("invoice-box").style.display = "block";
}

// PDF DOWNLOAD
function downloadInvoice() {
    const { jsPDF } = window.jspdf;
    let doc = new jsPDF();

    let name = document.getElementById("inv-name").innerText;
    let type = document.getElementById("inv-type").innerText;
    let amount = document.getElementById("paid-amount").innerText;
    let txn = document.getElementById("txn-id").innerText;
    let date = document.getElementById("paid-date").innerText;

    doc.setFontSize(18);
    doc.text("Loan Payment Invoice", 20, 20);

    doc.setFontSize(12);
    doc.text(`Name: ${name}`, 20, 40);
    doc.text(`Loan Type: ${type}`, 20, 50);

    doc.text(`Amount Paid: ₹${amount}`, 20, 70);
    doc.text(`Transaction ID: ${txn}`, 20, 80);
    doc.text(`Date: ${date}`, 20, 90);

    doc.text("This is a system-generated invoice.", 20, 110);

    doc.save(`Invoice_${txn}.pdf`);
}
</script>

</body>
</html>
